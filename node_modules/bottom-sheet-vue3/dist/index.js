"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const t=require("vue");const x="data-bottom-sheet-stop",p={type:Boolean,default:!1},H={threshold:{type:Number,default:100},onlyHeaderSwipe:p,noStretch:p,noClickOutside:p,noHeader:p},P=Symbol("BottomSheet");function T(){const n=t.ref(-1);let r=0;const l={activeSheet:n,id:()=>++r};return{install(S){S.provide(P,l)}}}function B(){return t.inject(P)}function M(n,r){return t.withModifiers(n,r)}const N=t.defineComponent({name:"SheetRenderer",props:{...H,id:{type:Number,required:!0}},emits:{updateElement:null,close:null},setup(n,{emit:r,slots:l}){const S=B(),o=t.ref(null);t.onUnmounted(()=>r("updateElement",null));let f=!0;const g=M(()=>{n.noClickOutside||!f||r("close")},["self"]),d=t.ref(!1),s=t.ref(0),u=t.ref(0);let a=!1,c=0;function h(){o.value&&(c=o.value.getBoundingClientRect().height)}function y(){var e,i;(e=o.value)==null||e.style.removeProperty("height"),(i=o.value)==null||i.style.removeProperty("max-height"),c=0,d.value=!1,s.value=0,u.value=0}function v(e){const i=o.value;if(!i||!a)return;let m;if("touches"in e?(m=e.touches[0].clientY,e.preventDefault()):m=e.clientY,m===u.value){d.value=!1;return}d.value=!0,s.value=m-u.value,f=!1,s.value<0&&!n.noStretch?(i.style.setProperty("height",`${c+Math.abs(s.value)}px`),i.style.setProperty("max-height","none")):(i.style.removeProperty("height"),i.style.removeProperty("max-height"))}function w(e){e.target instanceof HTMLElement&&e.target.closest(`[${x}]`)||("touches"in e?u.value=e.touches[0].clientY:u.value=e.clientY,a=!0)}function b(){const e=o.value;!a||!e||(s.value>=n.threshold?r("close"):setTimeout(()=>{f=!0,e.animate([{height:e.style.height},{height:`${c}px`}],{duration:200,easing:"ease"}).addEventListener("finish",()=>{e.style.removeProperty("height"),e.style.removeProperty("max-height")})}),d.value=!1,u.value=0,s.value=0,a=!1)}function C(e){n.onlyHeaderSwipe&&w(e)}function E(e){n.onlyHeaderSwipe||w(e)}const k=[["resize",y],["resize",h],["mousemove",v],["mouseup",b],["touchend",b],["touchcancel",b],["touchmove",v,{passive:!1}]];return t.onMounted(()=>{h();for(const[e,i,m]of k)window.addEventListener(e,i,m)}),t.onUnmounted(()=>{for(const[e,i]of k)window.removeEventListener(e,i)}),()=>{var e;return t.createVNode("div",{class:"bottom-sheet-backdrop","data-sheet-active":n.id===S.activeSheet.value?"":null,draggable:!1,onClick:g,onMousedown:E,onTouchstart:E},[t.createVNode("div",{ref:o,class:"bottom-sheet","data-swiping":d.value?"":null,style:{transform:`translateY(${Math.max(s.value,0)}px)`}},[n.noHeader?null:t.createVNode("div",{onMousedown:C,onTouchstart:C,class:"bottom-sheet-header"},[l.header?l.header():t.createVNode("div",{class:"bottom-sheet-header-bar"},null)]),t.createVNode("div",{class:"bottom-sheet-body"},[(e=l.default)==null?void 0:e.call(l)])])])}}}),Y=t.defineComponent({name:"Sheet",inheritAttrs:!1,props:{...H,visible:{type:Boolean,required:!0}},emits:{"update:visible":null},setup(n,{attrs:r,slots:l,emit:S}){const o=B(),f=o.id();let g=o.activeSheet.value;t.watch(()=>n.visible,a=>{a?(g=o.activeSheet.value,o.activeSheet.value=f):o.activeSheet.value=g},{immediate:!0});function d(){S("update:visible",!1)}function s(a,c){const h=a.querySelector(".bottom-sheet"),y=window.getComputedStyle(a).backgroundColor;a.animate([{backgroundColor:"rgba(0, 0, 0, 0)"},{backgroundColor:y}],{duration:300,easing:"ease"});const v=h.animate([{transform:"translateY(100%)"},{transform:"translateY(0%)"}],{duration:300,easing:"ease"});v.onfinish=c}function u(a,c){const h=a.querySelector(".bottom-sheet"),y=window.getComputedStyle(a).backgroundColor;a.animate([{backgroundColor:y},{backgroundColor:"rgba(0, 0, 0, 0)"}],{duration:300,easing:"ease"});const v=h.animate([{transform:h.style.transform},{transform:"translateY(100%)"}],{duration:300,easing:"ease"});v.onfinish=c}return t.onUnmounted(()=>{o.activeSheet.value=g}),()=>t.createVNode(t.Teleport,{to:"body"},{default:()=>[t.createVNode(t.Transition,{css:!1,onEnter:s,onLeave:u},{default:()=>[n.visible&&t.createVNode(N,t.mergeProps({id:f,onClose:d},r,{noClickOutside:n.noClickOutside,noHeader:n.noHeader,noStretch:n.noStretch,onlyHeaderSwipe:n.onlyHeaderSwipe,threshold:n.threshold}),l)]})]})}});exports.Sheet=Y;exports.createBottomSheet=T;
