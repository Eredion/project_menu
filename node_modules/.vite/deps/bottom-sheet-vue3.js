import {
  Teleport,
  Transition,
  createVNode,
  defineComponent,
  inject,
  mergeProps,
  onMounted,
  onUnmounted,
  ref,
  watch,
  withModifiers
} from "./chunk-U3LI7FBV.js";

// node_modules/bottom-sheet-vue3/dist/index.mjs
var N = "data-bottom-sheet-stop";
var w = {
  type: Boolean,
  default: false
};
var B = {
  threshold: {
    type: Number,
    default: 100
  },
  onlyHeaderSwipe: w,
  noStretch: w,
  noClickOutside: w,
  noHeader: w
};
var T = Symbol("BottomSheet");
function I() {
  const t = ref(-1);
  let i = 0;
  const l = {
    activeSheet: t,
    id: () => ++i
  };
  return {
    install(S) {
      S.provide(T, l);
    }
  };
}
function Y() {
  return inject(T);
}
function _(t, i) {
  return withModifiers(t, i);
}
var j = defineComponent({
  name: "SheetRenderer",
  props: {
    ...B,
    id: {
      type: Number,
      required: true
    }
  },
  emits: {
    updateElement: null,
    close: null
  },
  setup(t, {
    emit: i,
    slots: l
  }) {
    const S = Y(), n = ref(null);
    onUnmounted(() => i("updateElement", null));
    let f = true;
    const g = _(() => {
      t.noClickOutside || !f || i("close");
    }, ["self"]), d = ref(false), r = ref(0), s = ref(0);
    let o = false, u = 0;
    function h() {
      n.value && (u = n.value.getBoundingClientRect().height);
    }
    function y() {
      var e, a;
      (e = n.value) == null || e.style.removeProperty("height"), (a = n.value) == null || a.style.removeProperty("max-height"), u = 0, d.value = false, r.value = 0, s.value = 0;
    }
    function v(e) {
      const a = n.value;
      if (!a || !o)
        return;
      let m;
      if ("touches" in e ? (m = e.touches[0].clientY, e.preventDefault()) : m = e.clientY, m === s.value) {
        d.value = false;
        return;
      }
      d.value = true, r.value = m - s.value, f = false, r.value < 0 && !t.noStretch ? (a.style.setProperty("height", `${u + Math.abs(r.value)}px`), a.style.setProperty("max-height", "none")) : (a.style.removeProperty("height"), a.style.removeProperty("max-height"));
    }
    function E(e) {
      e.target instanceof HTMLElement && e.target.closest(`[${N}]`) || ("touches" in e ? s.value = e.touches[0].clientY : s.value = e.clientY, o = true);
    }
    function b() {
      const e = n.value;
      !o || !e || (r.value >= t.threshold ? i("close") : setTimeout(() => {
        f = true, e.animate([{
          height: e.style.height
        }, {
          height: `${u}px`
        }], {
          duration: 200,
          easing: "ease"
        }).addEventListener("finish", () => {
          e.style.removeProperty("height"), e.style.removeProperty("max-height");
        });
      }), d.value = false, s.value = 0, r.value = 0, o = false);
    }
    function k(e) {
      t.onlyHeaderSwipe && E(e);
    }
    function H(e) {
      t.onlyHeaderSwipe || E(e);
    }
    const x = [["resize", y], ["resize", h], ["mousemove", v], ["mouseup", b], ["touchend", b], ["touchcancel", b], ["touchmove", v, {
      passive: false
    }]];
    return onMounted(() => {
      h();
      for (const [e, a, m] of x)
        window.addEventListener(e, a, m);
    }), onUnmounted(() => {
      for (const [e, a] of x)
        window.removeEventListener(e, a);
    }), () => {
      var e;
      return createVNode("div", {
        class: "bottom-sheet-backdrop",
        "data-sheet-active": t.id === S.activeSheet.value ? "" : null,
        draggable: false,
        onClick: g,
        onMousedown: H,
        onTouchstart: H
      }, [createVNode("div", {
        ref: n,
        class: "bottom-sheet",
        "data-swiping": d.value ? "" : null,
        style: {
          transform: `translateY(${Math.max(r.value, 0)}px)`
        }
      }, [t.noHeader ? null : createVNode("div", {
        onMousedown: k,
        onTouchstart: k,
        class: "bottom-sheet-header"
      }, [l.header ? l.header() : createVNode("div", {
        class: "bottom-sheet-header-bar"
      }, null)]), createVNode("div", {
        class: "bottom-sheet-body"
      }, [(e = l.default) == null ? void 0 : e.call(l)])])]);
    };
  }
});
var D = defineComponent({
  name: "Sheet",
  inheritAttrs: false,
  props: {
    ...B,
    visible: {
      type: Boolean,
      required: true
    }
  },
  emits: {
    "update:visible": null
  },
  setup(t, {
    attrs: i,
    slots: l,
    emit: S
  }) {
    const n = Y(), f = n.id();
    let g = n.activeSheet.value;
    watch(() => t.visible, (o) => {
      o ? (g = n.activeSheet.value, n.activeSheet.value = f) : n.activeSheet.value = g;
    }, {
      immediate: true
    });
    function d() {
      S("update:visible", false);
    }
    function r(o, u) {
      const h = o.querySelector(".bottom-sheet"), y = window.getComputedStyle(o).backgroundColor;
      o.animate([{
        backgroundColor: "rgba(0, 0, 0, 0)"
      }, {
        backgroundColor: y
      }], {
        duration: 300,
        easing: "ease"
      });
      const v = h.animate([{
        transform: "translateY(100%)"
      }, {
        transform: "translateY(0%)"
      }], {
        duration: 300,
        easing: "ease"
      });
      v.onfinish = u;
    }
    function s(o, u) {
      const h = o.querySelector(".bottom-sheet"), y = window.getComputedStyle(o).backgroundColor;
      o.animate([{
        backgroundColor: y
      }, {
        backgroundColor: "rgba(0, 0, 0, 0)"
      }], {
        duration: 300,
        easing: "ease"
      });
      const v = h.animate([{
        transform: h.style.transform
      }, {
        transform: "translateY(100%)"
      }], {
        duration: 300,
        easing: "ease"
      });
      v.onfinish = u;
    }
    return onUnmounted(() => {
      n.activeSheet.value = g;
    }), () => createVNode(Teleport, {
      to: "body"
    }, {
      default: () => [createVNode(Transition, {
        css: false,
        onEnter: r,
        onLeave: s
      }, {
        default: () => [t.visible && createVNode(j, mergeProps({
          id: f,
          onClose: d
        }, i, {
          noClickOutside: t.noClickOutside,
          noHeader: t.noHeader,
          noStretch: t.noStretch,
          onlyHeaderSwipe: t.onlyHeaderSwipe,
          threshold: t.threshold
        }), l)]
      })]
    });
  }
});
export {
  D as Sheet,
  I as createBottomSheet
};
//# sourceMappingURL=bottom-sheet-vue3.js.map
